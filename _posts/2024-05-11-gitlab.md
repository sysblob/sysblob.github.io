---
title: Gitlab for a homelab repository
image: gitlab.svg
img_path: /images/
date: 2024-05-11
categories: [homelabbing]
tags: [gitlab]
pin: false
comments: true
---

Gitlab is an excellent choice for someone looking to self-host a coding or documentation repository. While most people are familiar with Github, more organizations these days are looking to self-host. Many orgs use Gitlab to store their Ansible playbooks, generate their documentation websites for internal SOPs, or just store scripts. 

There are many ways to host a Gitlab instance, and also many ways to secure it. I prefer the linux package installation along with either a manual SSL setup, or the built in let's encrypt setup. 

## Requirements:
- RHEL / Rocky linux
- SSH connection to your server

## Installation

1. Install prerequisite packages.

```
dnf install policycoreutils-python-utils openssh-server perl
```

2. A restart of sshd is necessary after the install of openssh-server. Also make sure you have it enabled.

```
systemctl restart sshd
systemctl enable sshd
```

3. Gitlab has a curl script which adds their repository to your server. It's one command which makes it simple.

```
curl https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.rpm.sh | bash
```

4. Install the gitlab community edition

```
dnf install -y gitlab-ce
```

5. Edit the configuration file for Gitlab. There are many possible lines to add. Here are some examples.


/etc/gitlab/gitlab.rb
```
external_url = 'http://gitlab.example.com'

# paste in this pair if you are using a reverse proxy
#nginx['listen_port'] = 80
#nginx['listen_https'] = false

# you can redirect http if you need
#ngnix['redirect_http_to_https'] = true
```

[Gitlab external_url docs](https://docs.gitlab.com/omnibus/settings/configuration.html#configure-the-external-url-for-gitlab)
* external_url is the main URL of your website. It's important that this match the url you intend to be hitting your website on. The copy paste of your Git repositories from Gitlab will be based off this address. If left as default it will assume http and serve out on port 80. When this is set to an https addres Gitlab automatically serves out content over port 443 instead.

[Gitlab ngnix docs](https://docs.gitlab.com/omnibus/settings/nginx.html#configuring-proxy-protocol)
#nginx['listen_port'] = 80 #nginx['listen_https'] = false
* If you require your external_url to be served out over http but want the URL to be https (such as a reverse proxy) you can control the built-in ngnix server that Gitlab uses to serve out content with ngnix one liners like these. 

6. Tell Gitlab to start with your current configuration (This is also how you reconfigure Gitlab from here on if you make any changes to the config file)

```
gitlab-ctl reconfigure
```

7. Gitlab is now up and running. Retrieve the root password.

```
cat /etc/gitlab/initial_root_password
```

8. Login by going to your external_url address or by the default address of http://hostname.com and using the username `root` with the password copied from intial_root_password file.